                                                                   Imperfect Forward Secrecy:
                                                       HowDifﬁe-HellmanFails in Practice
                                                ¶                                               ∗                                  ¶                                 †                                §
                        David Adrian                Karthikeyan Bhargavan                            Zakir Durumeric                   Pierrick Gaudry                   Matthew Green
                                                              ¶                                ‡                               ¶                                      †                            ‡
                           J. Alex Halderman                      Nadia Heninger                    DrewSpringall                   EmmanuelThomé LukeValenta
                                                                      ¶                            ¶                                                      k                                      †
                            Benjamin VanderSloot                           Eric Wustrow                 Santiago Zanella-Béguelin                             Paul Zimmermann
                                      ∗INRIA Paris-Rocquencourt                          † INRIA Nancy-Grand Est, CNRS, and Université de Lorraine
                                kMicrosoft Research                    ‡ University of Pennsylvania                       § Johns Hopkins                 ¶University of Michigan
                                                         For additional materials and contact information, visit WeakDH.org.
                    ABSTRACT                                                                                     coded, or widely shared Diﬃe-Hellman parameters has the
                   Weinvestigate the security of Diﬃe-Hellman key exchange as                                    eﬀect of dramatically reducing the cost of large-scale attacks,
                    used in popular Internet protocols and ﬁnd it to be less secure                              bringing some within range of feasibility today.
                    than widely believed. First, we present Logjam, a novel ﬂaw                                      The current best technique for attacking Diﬃe-Hellman
                    in TLS that lets a man-in-the-middle downgrade connections                                   relies on compromising one of the private exponents (a, b)
                    to “export-grade” Diﬃe-Hellman. To carry out this attack,                                    by computing the discrete log of the corresponding public
                    we implement the number ﬁeld sieve discrete log algorithm.                                   value (ga mod p, gb mod p). With state-of-the-art number
                    After a week-long precomputation for a speciﬁed 512-bit                                      ﬁeld sieve algorithms, computing a single discrete log is more
                    group, we can compute arbitrary discrete logs in that group                                  diﬃcult than factoring an RSA modulus of the same size.
                    in about a minute. We ﬁnd that 82% of vulnerable servers use                                 However, an adversary who performs a large precomputation
                    a single 512-bit group, allowing us to compromise connections                                for a prime p can then quickly calculate arbitrary discrete logs
                    to 7% of Alexa Top Million HTTPS sites. In response, major                                   in that group, amortizing the cost over all targets that share
                    browsers are being changed to reject short groups.                                           this parameter. Although this fact is well known among
                       WegoontoconsiderDiﬃe-Hellmanwith768-and1024-bit                                           mathematical cryptographers, it seems to have been lost
                    groups. We estimate that even in the 1024-bit case, the com-                                 among practitioners deploying cryptosystems. We exploit it
                    putations are plausible given nation-state resources. A small                                to obtain the following results:
                    number of ﬁxed or standardized groups are used by millions                                   Active attacks on export ciphers in TLS.                          We introduce
                    of servers; performing precomputation for a single 1024-bit                                  Logjam, a new attack on TLS by which a man-in-the-middle
                    group would allow passive eavesdropping on 18% of popular                                    attacker can downgrade a connection to export-grade cryp-
                    HTTPS sites, and a second group would allow decryption                                       tography. This attack is reminiscent of the FREAK attack [7]
                    of traﬃc to 66% of IPsec VPNs and 26% of SSH servers. A                                      but applies to the ephemeral Diﬃe-Hellman ciphersuites and
                    close reading of published NSA leaks shows that the agency’s                                 is a TLS protocol ﬂaw rather than an implementation vulner-
                    attacks on VPNs are consistent with having achieved such                                     ability. We present measurements that show that this attack
                    a break. We conclude that moving to stronger key exchange                                    applies to 8.4% of Alexa Top Million HTTPS sites and 3.4%
                    methods should be a priority for the Internet community.                                     of all HTTPS servers that have browser-trusted certiﬁcates.
                                                                                                                     To exploit this attack, we implemented the number ﬁeld
                    1.     INTRODUCTION                                                                          sieve discrete log algorithm and carried out precomputation
                       Diﬃe-Hellman key exchange is widely used to establish                                     for two 512-bit Diﬃe-Hellman groups used by more than
                    session keys in Internet protocols. It is the main key exchange                              92% of the vulnerable servers. This allows us to compute
                    mechanism in SSH and IPsec and a popular option in TLS.                                      individual discrete logs in about a minute. Using our discrete
                   Weexamine how Diﬃe-Hellman is commonly implemented                                            log oracle, we can compromise connections to over 7% of Top
                    and deployed with these protocols and ﬁnd that, in practice,                                 Million HTTPS sites. Discrete logs over larger groups have
                    it frequently oﬀers less security than widely believed.                                      been computed before [8], but, as far as we are aware, this
                       There are two reasons for this. First, a surprising number                                is the ﬁrst time they have been exploited to expose concrete
                    of servers use weak Diﬃe-Hellman parameters or maintain                                      vulnerabilities in real-world systems.
                    support for obsolete 1990s-era export-grade crypto. More                                         Wewere also able to compromise Diﬃe-Hellman for many
                    critically, the common practice of using standardized, hard-                                 other servers because of design and implementation ﬂaws and
                                                                                                                 conﬁguration mistakes. These include use of composite-order
                                                                                                                 subgroups in combination with short exponents, which is
                                                                                                                 vulnerable to a known attack of van Oorschot and Wiener [51],
                    Permission to make digital or hard copies of part or all of this work for personal or        andtheinability of clients to properly validate Diﬃe-Hellman
                    classroom use is granted without fee provided that copies are not made or distributed        parameters without knowing the subgroup order, which TLS
                    for proﬁt or commercial advantage and that copies bear this notice and the full cita-        has no provision to communicate. We implement these
                    tion on the ﬁrst page. Copyrights for third-party components of this work must be            attacks too and discover several vulnerable implementations.
                    honored. For all other uses, contact the Owner/Author(s). Copyright is held by the
                    owner/author(s).                                                                             Risks from common 1024-bit groups.                        We explore the im-
                    CCS’15, October 12–16, 2015, Denver, Colorado, USA.                                          plications of precomputation attacks for 768- and 1024-bit
                    ACM978-1-4503-3832-5/15/10.                                                                  groups, which are widely used in practice and still considered
                    DOI:http://dx.doi.org/10.1145/2810103.2813707.
