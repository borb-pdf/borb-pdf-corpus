                                                                                                                                                                                                                                                                                          en:µKanr    A           Minimal      Functional  eCor
                                                                                                                                                                                                                                                                                                                                                             orf         Relational  ogrammingPr
                                                                                                                                                                                                                                                                                                                                                                                             Jason Hemann                      Daniel.PFriedman
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         IndianaersityvUni
                                                                                                                                                                                                                                                                                                                                                                                                                                  {jhemann,dfried}@cs.indiana.edu
                                                                                                Abstract                                                                                                                                                                                                                                                                                                                                                                                                                                                                       the  ssystem'internalsaremademanifest.Whatismore,by
                                                                                                This  paper presentsµKanren,aminimalistlanguageinthe                                                                                                                                                                                                                                                                                                                                                                                                                           re-adjudicatingwhatfunctionsareproperlythewpurvieof
                                                                                                miniKanrenamilyfof  relational(logic)programminglan-                                                                                                                                                                                                                                                                                                                                                                                                                           the end,userweelopvdeanimplementationthatweighsinat
                                                                                                guages.Itsimplementationcompriseswerfethan40linesof                                                                                                                                                                                                                                                                                                                                                                                                                            39   linesof Scheme.Thepresentationofthelanguageandits
                                                                                                Scheme.eWatevmotitheneedfora minimalistminiKanren                                                                                                                                                                                                                                                                                                                                                                                                                              featuresws.folloThecompleteimplementationofµKanren
                                                                                                language,andelyviteratielopvdeacompletesearch.gystrate                                                                                                                                                                                                                                                                                                                                                                                                                         is   foundin  the appendix.
                                                                                               ,Finallywe      demonstratethat throughcientsufelv-leuser
                                                                                                featuresone    ainsgremuch    of     the    enessvxpressieofother                                                                                                                                                                                                                                                                                                                                                                                                              2.                   The  enµKanrLanguage
                                                                                                miniKanrenlanguages.Inouropinionits vitybreand  sim-                                                                                                                                                                                                                                                                                                                                                                                                                           Herein,webrieydescribethesyntaxofµKanrenprograms,
                                                                                                ple semanticsemakµKanrenuniquelyant.gele                                                                                                                                                                                                                                                                                                                                                                                                                                       with  a     focus on   those areas in   which µKanrenfersdiffrom
                                                                                                Categories  and         Subject     Descriptors                                                                                                                                                                                                                                                       D.3.2       [                                            egLangua                                                                                                        earlierminiKanrenlanguages.Readersintimatelyamiliarf
                                                                                                Classications                                                                                         ]:      evApplicati(functional)languages,Con-                                                                                                                                                                                                                                                                                                                           with miniKanrenprogrammingmaylightlyperusethissec-
                                                                                                straintandlogiclanguages                                                                                                                                                                                                                                                                                                                                                                                                                                                       tion;readersseekingathoroughintroductiontominiKanren
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               programmingaredirectedto Byrd   [                                                                                                                                                                                                                                   3        ]     and   Friedmanet.  al
                                                                                               ordseywK                                                                                miniKanren,relationalprogramming,logicpro-                                                                                                                                                                                                                                                                                                                                              [     4        ],  from whichthe presentdiscussionisadapted.
                                                                                                gramming,Scheme                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     A     µKanrenprogramproceedsthroughtheapplicationof
                                                                                                1.                  oductionIntr                                                                                                                                                                                                                                                                                                                                                                                                                                               a             goal                                to    a                          state                            .    Goals are  often understoodbyanalogyto
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               predicates.Whereastheapplicationofapredicatetoanele-
                                                                                                miniKanrenistheprincipalmemberofanymouseponam-f                                                                                                                                                                                                                                                                                                                                                                                                                                mentof   its domaincanbe eithertrueoralse,fa goalpursued
                                                                                                ily    of     relational(logic)programminglanguages.yManof                                                                                                                                                                                                                                                                                                                                                                                                                     in    a    envgistatecan   either                                                                                                                                                            succeed                                                       or                  fail                   .    A    sgoal'success
                                                                                                its criticaldesigndecisionsareareactiontothoseofProlog                                                                                                                                                                                                                                                                                                                                                                                                                         may  resultina   sequenceofged)(enlarstates,whichweterm
                                                                                                and  otherwnwell-kno5th-generationlanguages.Oneofthe                                                                                                                                                                                                                                                                                                                                                                                                                           a           eamstr                                              [     12               ]. e W use  functionstosimulaterelations.An-ar
                                                                                               erencesfdifis that,   while  a      typicalProlog implementation                                                                                                                                                                                                                                                                                                                                                                                                                bitrary                                            n-ary relation   is wedvieasan                                                                                                                                                                                (n−1)-ary partial func-
                                                                                                might be    thousandsof  lines of    C      code, a     miniKanrenlan-                                                                                                                                                                                                                                                                                                                                                                                                         tion,  mappingtuplesof     domainelementsinto a      linearized
                                                                                                guage   is      usually implementedin   wheresomeunder  1000                                                                                                                                                                                                                                                                                                                                                                                                                   submultisetofelementsofthecodomainervowhichtheini-
                                                                                                lines.  Though   there    are     miniKanrenlanguagesof     ariedv                                                                                                                                                                                                                                                                                                                                                                                                             tial relationholds.Aenvgicollectionofgoalsmaybesatis-
                                                                                                sizesand   featuresets(see                                                                                                                                                                    http://miniKanren.org                                                                                                                                                                             ),    the                                                                      ed by   zeroor  morestates.Theresultofa µKanrenprogram
                                                                                                originalpublishedimplementationasw265linesofScheme                                                                                                                                                                                                                                                                                                                                                                                                                             is    a    streamof  satisfyingstates.Thestreammaybenite or
                                                                                                code.In  thosewfe lines,it  videsproanenessvxpressiecom-                                                                                                                                                                                                                                                                                                                                                                                                                       innite,as there may  be    niteor    innitelyymansatisfying
                                                                                                parableto      that    of     an      implementationofa      pure   subset  of                                                                                                                                                                                                                                                                                                                                                                                                 states.
                                                                                                Prolog.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             A    sprogram'resultingstreamthusdependsonthegoals
                                                                                                                   e W     gue,ar though, that   deeply uriedb  within that    265-                                                                                                                                                                                                                                                                                                                                                                                            that comprisethatprogram.InµKanrentherearefourprim-
                                                                                                line miniKanrenimplementationisasmall,beautiful,rela-                                                                                                                                                                                                                                                                                                                                                                                                                          eviti goal  constructors:                                                                                                                                                  ≡, call/fresh                                                                                                           ,         disj                                 ,      and                                 conj                                 .
                                                                                                tionalprogramminglanguageseekingtogetout.eWevbelie                                                                                                                                                                                                                                                                                                                                                                                                                             The                             ≡ goal constructor           is  the primaryorkhorsewofthesys-
                                                                                                µKanrenis    that   language.By  minimizingtheoperatorsto                                                                                                                                                                                                                                                                                                                                                                                                                      tem;   goals  constructedfrom                                                                                                                                                                                      ≡ succeed                     when   the    otw   -ar
                                                                                                those  strictlynecessaryto  do     relationalprogrammingand                                                                                                                                                                                                                                                                                                                                                                                                                    guments                                                           unify                                    [    1        ].    The   successof  goals uiltbfrom                                                                                                                                                                                                                  ≡ may
                                                                                                placingmuchof  the  aceinterfdirectlyunderthesuser'con-                                                                                                                                                                                                                                                                                                                                                                                                                        causethe stateto.wgroeUnliktheimplementationof                                                                                                                                                                                                                                                                                                                                             ≡ de-
                                                                                                trol, we   evha  furthersimpliedtheimplementationandil-                                                                                                                                                                                                                                                                                                                                                                                                                       tailed in     Friedmanet.   al     [                                                                                                                                                          4        ],     that   presentedheredoes   not
                                                                                                luminatedthe role   and    interrelationshipsoftheremaining                                                                                                                                                                                                                                                                                                                                                                                                                    prohibitcircularitiesinthesubstitution.
                                                                                                components.Bymakingthe  implementationentirelyfunc-                                                                                                                                                                                                                                                                                                                                                                                                                                                 The                              call/fresh                                                                                        goal  constructorcreatesafreshw)(ne
                                                                                                tionaland oidvdeof    macros,heretoforeopaquesectionsof                                                                                                                                                                                                                                                                                                                                                                                                                        logicariable.v                                                                                          call/fresh                                                                                 s'  solegumentarisaunaryfunc-
                                  tionwhosebindingariablevisafreshlogicariablevand                                                                                                                  queries.Theresultingstreamcontainsotwresults,which
                                  whosebodyisanxpressioneervowhichthefreshsariable'v                                                                                                                representayswtojointlysatisfybothqueries.Therstresult
                                  bindingisscopedandwhichaluatesvetoagoal.                                                                                                                          producedisthestatewhosesubstitutionrepresentstheuni-
                                         The         disj           and        conj           goalconstructorsxpresseasortof                                                                        cationoftherstariablevwiththenumber7,andthesecond
                                  booleanlogicervoygoalstherepresentthebinarydisjunc-                                                                                                              with5;thextnesstate'substitutionisthatrepresentingstill
                                  tionandconjunctionofgoals,.elyvrespectiThatis,bothetak                                                                                                            theunicationoftherstariablevwith7,utbthesecond
                                  otwgoalsasguments.arAgoalconstructedfrom                                                                                     disj           re-                   ariablevthistimewith6.Theusermaywishtowviethese
                                  turnsanon-emptystreamifeitherofitsotwgumentsarare                                                                                                                 resultswithrespecttotherstariable,vthesecondariable,v
                                  successful,andagoalconstructedfrom                                                                conj           returnsanon-                                     both,orµKanrenneitheresvleathatdecisiontothe.user
                                  emptystreamifthesecondgumentarcanbeedvachieinthe                                                                                                                         ThisxampleealsodemonstratesaµKanrenrelationglob-
                                  streamgeneratedbytherst.Boththenamesandimple-                                                                                                                    allydenedasonemightanordinarySchemefunction.As
                                  mentationsof                        disj           and        conj            areinspiredbythoseforms                                                             µKanrenisembeddedinScheme,usersmaydenegoalsand
                                  inSokuzaKanren[                                6  ].                                                                                                              specifyrelationsinSchemeandusethemintheecutionxeof
                                         A stateisapairofasubstitution(representedasanasso-                                                                                                         aµKanrenprogram.
                                  ciationlist)andaevatignon-negerinterepresentingafresh-
                                  ariablev.counterInµKanren,asinmostminiKanrenlan-                                                                                                                  3.     DesignyPhilosoph
                                  guages,weusetriangularsubstitutions[                                                             1  ].InaµKanrenpro-
                                  gram,therstariablevwillayswalbe                                                              #(0)          (aectorvwhose                                         ThoughtheµKanrendesignwsdraagreatdealofinspiration
                                  onlyelementis0),althoughitsbindingwillnotayswalbe                                                                                                                 fromthatofFriedmanet.al[                                                  4  ],certainphilosophicalcon-
                                  theinitialentryinthesubstitution.                                                                                                                                 cernsmandateanumberofsignicantchangestothedesign
                                         Theuserofthesystemginsbeaprogrambyapplying                                                                                                                 andaceinterfofthesystem.eWrstdescribethosea-vmoti
                                  a  goaltoa   state.Thatgoalmaybearbitrarilycompli-                                                                                                                tionsandwiththeminmindstepthroughtheimplementa-
                                  cated.Mostfrequentlytheinitialgoaliscreatedfroma                                                                                                                  tion.
                                  call/fresh                      . Thealuevofapplyingthatgoaltoastateis                                                                                                   ThoughtheµKanrenimplementationpresentedhereinis
                                  a stream.Astreamisconceptuallyapossibly-unbounded                                                                                                                 short,andweconsideritssizeavirtue,ittisn'shortfor
                                  listofstates.Whileinprincipletheuserofthesystemmay                                                                                                               svity'bree.sakDesigningapureandsimplefunctionalpro-
                                  ginbewithyanstate,inpracticetheuseralmostayswalbe-                                                                                                                gramwillbringessentialstothefore.Thisentailsstripping
                                  ginswith                empty-state                         .  empty-state                          isaelv-leuseralias                                            aywaaceinterfcomponentsthat,whiledesirable,properly
                                  forastatevirtuallyoidvdeofinformation:thesubstitutionis                                                                                                           oughttobethewpurvieofthe.userDoingsohelpstocrys-
                                 ,emptyandtherstariablevwillbeedxindeat0.Consider                                                                                                                  tallizethearchitectureofaeminiKanren-likslanguage'-erk
                                  thewbeloxampleeµKanren.query                                                                                                                                      nel.
                                       > (deney-stateempt                                ' (() .  0))                                                                                                     Whenattemptingtounderstandtheimplementationof
                                       > ((call/fresh(                    λ (q)   (        ≡ q 5)))    y-stateempt)                                                                                 a typicalminiKanrenlanguage,thescopeandxitycomple
                                       ((((#(0).5)).1))                                                                                                                                             ofthesystemcanbeerwhelming,voforstudentsandsea-
                                  Intheocationvinpresentede,vabotheresultisthealuev                                                                                                                 sonedelopersvdee.alikenEvifµKanrentisn'thelanguagein
                                  of  the goal                       (call/fresh(                              λ (q)     (            ≡ q 5)))                       in  the                        whichonewillprogram,understandingtheinternalsofthis
                                  empty-state                        . Thisisastream.Herethisresultisastream                                                                                        implementationwillclarifytheinnerorkingswofminiKan-
                                  ofxactlyeoneresultingstate.Inthisstate,thesubstitution                                                                                                            renlanguages.generallyoo,Tweguearbyxampleethat
                                  bindsasingleariablev                                      #(0)           to 5.The                  1    denotestheother                                           µKanrenmayvideproamoreardstraightforwplatformon
                                  partofthestate,theariablevcounter:here1isthextne                                                                                                                  whichtoaddfeaturesthanamonolithicarchitecture.
                                 ailablevaariablevxindeforthextne                                                             call/fresh                      . Thecdr                                     TheevadjectimonolithicandthenameµKanrenarecho-
                                  is    ()    ,  theemptystream,whichmeanstherearenofurther                                                                                                         sen.advisedlyOneofthedesignmetaphorsofµKanrenis
                                  results.µKanrenprograms,ingeneral,arenotguaranteedto                                                                                                              thatofaernelmicrokoperatingsystem.Aernelmicrokcon-
                                  terminate,andsomaynotreturnwitharesult.Asecondx-e                                                                                                                 sistsoftheminimumor-minimumnearamountofaresoftw
                                  ampledemonstratestheuseoftheremainingevprimitigoal                                                                                                                requiredtoimplementanoperatingsystem[                                                                          2  ].Inaddition
                                  constructors.                                                                                                                                                     tosecurityassurances,ernels,microkbyvirtueoftheirsmall
                                                                                                                                                                                                    sizeandlimitedscope,tendtobeeasiertomaintain,easier
                                       > (denea-and-b                                                                                                                                              toeepkfreeofugs,bandeasiertounderstand.oTwborro
                                                (conj                                                                                                                                               another,metaphorthistimefromaresoftwengineering,min-
                                                     (call/fresh(                λ (a)   (        ≡ a 7)))                                                                                          imizingoftheresponsibilitiesoftheernelkandpushingall
                                       > (a-and-by-state)empt(call/fresh(        λ (b)   (disj(              ≡ b 5) (              ≡ b 6))))))                                                      thatcanbeintouserspaceloosenscouplingandincreases
                                       ((((#(1).5)(#(0).7)).2)                                                                                                                                      thecohesionofthesystem,andhelpseliminateinappropri-
                                         (((#(1).6)(#(0).7)).2))                                                                                                                                    ateyintimacamongsubmodules.Theresultingsystemisby
                                         In  thisxample,etheoutermostgoalofthequeryis                                                                                                               designmoreclearlycorrect,withwerfepiecestoconsider
                                  notuiltbfrom                          call/fresh                      . Insteaditisaconjunctionof                                                                 simultaneouslyandacleardelineationofresponsibilities.
                                                                                      4.                 enµKanrImplementation                                                                                                                                                                                                                                                                                                                                                                                         .other ,Finallyariable,non-vnon-pairtermsunifyif    ythe
                                                                                      The entiresystemiscomprisedofahandfuloffunctionsfor                                                                                                                                                                                                                                                                                                                                                                               are    identicalunder                                                                                                              eqv?                             ,      and     unicationailsfotherwise.
                                                                                      the implementationofariables,vstreamses,themselvthein-                                                                                                                                                                                                                                                                                                                                                                            The  denitionof                                                                                                  unify                                          and   the  termsof    the  languageare
                                                                                      aceterfforcreatingandcombiningstreams,andfourprimi-                                                                                                                                                                                                                                                                                                                                                                               orthogonalto the   presentationofµKanren:bothcould  be
                                                                                      evtigoalconstructors.                                                                                                                                                                                                                                                                                                                                                                                                             changedwithlimitedconsequencefortherestofthesystem.
                                                                                                        ariablesVesthemselvarerepresentedasectorsvthathold                                                                                                                                                                                                                                                                                                                                                                           (dene   (unify    u    v     s)
                                                                                      theirariablevx.indeariableVequalityisdeterminedbyco-                                                                                                                                                                                                                                                                                                                                                                                                        (     let                   ((u    (alkw u    s))     (v     (alkw v     s)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (     cond
                                                                                      incidenceofindicesinectors.v                                                                                                                                                                                                                                                                                                                                                                                                                                                        ((and r?(va  u)    (r?va  v)     (r=?vau  v))    s)
                                                                                                    (dene  (rva    c)     (rvecto  c))                                                                                                                                                                                                                                                                                                                                                                                                                                   ((r?va  u)    (ext-s    u     v     s))
                                                                                                    (dene  (r?va   x)    (r?vecto x))                                                                                                                                                                                                                                                                                                                                                                                                                                    ((r?va  v)     (ext-s    v     u    s))
                                                                                                    (dene  (r=?vax                                                                                  1 x 2) (=ref- r(vecto x                                                                                                  1 0) ref- (rvecto     x                                                                            2 0)))                                                                                                                                   ((and (pair?   u)    (pair?   v))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                (     let                   ((s      (unify    (rca    u)    (rca    v)     s)))
                                                                                                         The                           walk                                  operatorsearchesforasariable'valuevinthe                                                                                                                                                                                                                                                                                                                                                                       (and s      (unify   (cdr    u)    (cdr   v)     s))))
                                                                                      substitution;the                                                                                                 ext-s                                             operatorxtendsethe     substitution                                                                                                                                                                                                                                                                              (else  (and (eqv?u    v)     s)))))
                                                                                      with  a     wne   binding.Whena    ariablenon-vtermised,alkw                                                                                                                                                                                                                                                                                                                                                                                         The   secondbasicgoal constructoris                                                                                                                                                                                                                 call/fresh                                                                         .    The
                                                                                      the  termitselfis returned.Whenxtendingethesubstitution,                                                                                                                                                                                                                                                                                                                                                                          call/fresh                                                                                  goal     constructorestak a        unary    function                                                                                                                                                                                                                                   f
                                                                                      the    rst  gumentaris  ayswal a     ariable,vandthe    secondis                                                                                                                                                                                                                                                                                                                                                                 whosebodyisa   goal,anditselfreturnsagoal.Thisreturned
                                                                                      an   arbitraryterm.InFriedmanet.al[                                                                                                                                                                                                                4       ],            ext-s                                         performsa                                                                                                  goal,whenvidedproastate                                                                                                                                                          s/c                     ,   bindstheformalparameter
                                                                                      check for   circularitiesinthe substitution;herethereisno                                                                                                                                                                                                                                                                                                                                                                         of               f           to a   wnelogicariablevuilt(bwiththeariablevconstruc-
                                                                                      suchprohibition.                                                                                                                                                                                                                                                                                                                                                                                                                  tor operator                                                                   var                      ),  and passesa state,withthesubstitutionit
                                                                                                    (dene  (alkw u    s)                                                                                                                                                                                                                                                                                                                                                                                               originallyedvreceiandawlyneincrementedariablefresh-v
                                                                                                                (     let                    ((rp    (and r?(va  u)    (assp  (                                                                                                                           λ (v)              (r=?vau   v))   s))))                                                                                                                                                                     ,counter                                                c       ,   to  the goalthatis  the bodyof                                                                                                                                                                   f       .
                                                                                                                            (if    rp     (alkw (cdr   rp)     s)      u)))                                                                                                                                                                                                                                                                                                                                                          (dene   (call/freshf)
                                                                                                    (dene  (ext-s     x     v     s)                                                                                                  `      ((,x     .    , v)     .   ,  s))                                                                                                                                                                                                                                                                   (     λg(s/c)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (     let                 ((c     (cdr   s/c)))
                                                                                                         The    rst   of    the    four   basic goal   constructors,                                                                                                                                                                                                                                                   ≡, estak                                                                                                                                          ((f      (rva    c))                                                          `      (, (rca    s/c)   .       , (+    c   1))))))
                                                                                      otw   terms as    gumentsarandreturnsa    goal                                                                                                                                                                                                                                            1           that  succeeds                                                                                                                                 The nalotwbasicgoalconstructorsare                                                                                                                                                                                                                                 disj                                 and                        conj                             .
                                                                                      if  thoseotwterms                                                                                                     unify                               in  theedvreceistate.Ifythe,unifya                                                                                                                                                                                                                                      The                         disj                                 goalconstructorestakotwgoalsasgumentsarand
                                                                                      substitution,possiblyxtended,eisreturned.Inthiscase,                                                                                                                                                                                                                                                                                                                         ≡                                                    returnsagoalthatsucceedsifeitheroftheotwsubgoalssuc-
                                                                                      passesthiswnesubstitution,pairedwiththeariablevcounter                                                                                                                                                                                                                                                                                                                                                                            ceed.The                                                         conj                                goalconstructorsimilarlyestakotwgoalsas
                                                                                      to  compriseastate,to                                                                                                                       unit                             .      unit                                 liftsthestateintoastream                                                                                                                                                                                 gumentsarandreturnsagoalthatsucceedsif                                                                                                                                                                                                                                                       both                           goalssuc-
                                                                                      whose  only   elementis     that   state. If     those  otw    terms  ailf                                                                                                                                                                                                                                                                                                                                                        ceedfor thatstate.
                                                                                      to    unify in    that  state,the   empty stream,                                                                                                                                                                                                                          mzero                                     ,     is    instead                                                                                                       (dene   (disj      g                                                                    1 g 2) (                                 λ (s/c)              (mplus(g                                                                           1 s/c)             (g                                 2 s/c))))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               g
                                                                                      returned.                                                                                                                                                                                                                                                                                                                                                                                                                                      (dene   (conj   g                                                                        1 g 2) (                                  λg(s/c)             (bind  (g                                                                    1 s/c)             g                             2)))
                                                                                                    (dene  (   (     λ (s/c)                            ≡ u v)                                                                                                                                                                                                                                                                                                                                                                            Theseare  implementedintermsofthe                                                                                                                                                                                                                            mplus                                          and                         bind
                                                                                                                              g                                                                                                                                                                                                                                                                                                                                                                                         operators,elyvrespecti                                                                                                                           2      .     It     is    throughthese  otw   operators
                                                                                                                            (     let                    ((s     (unify    u    v     (rca    s/c))))
                                                                                                                                        (if     s      (unit                                                 `      (,s      .       ,  (cdr   s/c)))   mzero))))                                                                                                                                                                                                                                                       thatthesearchgystrateofµKanrenisencoded.eWelyviterati
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       elopvdeersionsvoftheseoperators,whichintheirnalform
                                                                                                    (dene    (unit    s/c)   (cons s/c    mzero))                                                                                                                                                                                                                                                                                                                                                                      willvideproacompletesearch.
                                                                                                    (dene    mzero                                                                       '   ())                                                                                                                                                                                                                                                                                                                                         eW ginbewithanimplementationthatiscorrectfornite
                                                                                                        ermsTof thelanguagearedenedbythe                                                                                                                                                                                                                                    unify                                       .operator                                                                                      relations.Theadditionof  otw   lines yieldsthe    capacityto
                                                                                      Here,  terms   of     the    languageconsistof    ariables,vobjects                                                                                                                                                                                                                                                                                                                                                               returnstreamsofyinnitely-manresults.Aslightchangeto
                                                                                      deemed identicalunder                                                                                                                                          eqv?                              ,     and   pairs  of    the   going.fore                                                                                                                                                                                        thisimplementationresultsinabreadth-rstsearchgystrate
                                                                                     oT     unify  otw    terms in     a      substitution,bothare edalkw in                                                                                                                                                                                                                                                                                                                                                            typicalofminiKanrenimplementations.
                                                                                      thatsubstitution.Iftheotwtermsalkwtothesameariable,v                                                                                                                                                                                                                                                                                                                                                                              4.1             FiniteDepth-FirstchSear
                                                                                      the   originalsubstitutionisreturnedunchanged.Whenone
                                                                                      of      the    otw    terms   alksw  to     a      ariable,vthe   substitutionis                                                                                                                                                                                                                                                                                                                                                  The                           mplus                                          operatorisresponsibleforgingmerstreams.In
                                                                                      xtended,ebindingthe   ariablevto     which   that   term    alksw                                                                                                                                                                                                                                                                                                                                                                 a   goal constructedfrom                                                                                                                                   disj                              ,   the resultingstreamcontains
                                                                                      with the aluevto   whichthe otherterm alks.wIf both terms                                                                                                                                                                                                                                                                                                                                                                         the statesthatresultfromsuccessofeitheroftheotwgoals.
                                                                                      alkw to  pairs,thecars and then cdrsare  unied,elyvrecursi                                                                                                                                                                                                                                                                                                                                                                       mplus                                          simplyappendsthelistreturnedas the  resultof  the
                                                                                      succeedingifunicationsucceedsintheone   and  then  the                                                                                                                                                                                                                                                                                                                                                                           rst call to   that returnedasthe  resultof  the second.In this
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        formit  is  simplyanimplementationof                                                                                                                                                                                                                    append                                            .
                                                                                      1     eW  usethe names                                                                                λ and                                   λ (formerly                                                            λ ) to yevcon information   to the
                                                                                                                                                                                                    g                                       $                                                                     f
                                                                                      readerandforyconsistencwithotherminiKanrenimplementations.The                                                                                                                                                                                                                                                                                                                         $                                           2      orFthosewhoperfertothinkintermsofmonads,thesedenitionsofbind                                                                                                                                                                                                                                                                                                                     ,
                                                                                      in            λ is for stream                and the                                                                                                        g         in            λ is for goal.                 In   the codeboth are                                                                                                                                                                                      and mplus                                            ,  togetherwiththeimplementationofunit                                                                                                                                                                                      and mzero                                             ,  comprise
                                                                                                            $                                                                                                                                                                       g
                                                                                      written                                lambda                                   .                                                                                                                                                                                                                                                                                                                                                 somethingakintothelistmonad.
.
                                                                                                   (dene  (mplus$                                                                                 1 $ 2)                                                                                                                                                                                                                                                                                                          stateanda stream,whichtogethercomprisethesstream'rst
                                                                                                               (     cond                                                                                                                                                                                                                                                                                                                                                                                          and remainingstates.
                                                                                                                           ((null?$                                           1)           $           2)                                                                                                                                                                                                                                                                                                                             The  redenitionof                                                                                                          mplus                                        wbeloand the  introductionof
                                                                                                                           (else  (cons (rca    $                                                                                   1)           (mplus(cdr  $                                                                       1)           $           2)))))                                                                                                                                               λ both arrantw xplanation.e    The changesfromtheviouspre
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            $
                                                                                     As  a  consequence,iftheocationvinofeitheroftheotwgoals                                                                                                                                                                                                                                                                                                                                                                       denitionarehighlighted.
                                                                                     on    the   state resultsin  an    innitestream,theocationvinof                                                                                                                                                                                                                                                                                                                                                                            (dene  (mplus$                                                                                 1 $ 2)
                                                                                     disj                                 willnot complete(becauseSchemeisalue).call-by-v                                                                                                                                                                                                                                                                                                                                                                    (     cond
                                                                                                        bind                                 is  requiredintheimplementationof                                                                                                                                                                                                    conj                             .                                                                                                                                     ((null?$                                          1)            $           2)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         .                                                                                                                                                                                                                                                .
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ((ropcedure?$                                                                       1)            (          λ$() (mplus            ($                                                          1) $                     2)))
                                                                                                   (dene  (bind  $     g)                                                                                                                                                                                                                                                                                                                                                                                                                               (else  (cons (rca    $                                                                                  1)            (mplus(cdr $                                                                        1)           $           2)))))
                                                                                                               (     cond
                                                                                                                           ((null?$)     mzero)                                                                                                                                                                                                                                                                                                                                                                                       Immaturestreamsare  implementedas                                                                                                                                                                                                                               λ s. The                      added
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               $
                                                                                                                           (else  (mplus(g  (rca    $))     (bind (cdr    $)     g)))))                                                                                                                                                                                                                                                                                                                            procedure?                                                                               line  matchesimmaturestreams.Theoca-vin
                                                                                     When a   goal constructedfrom                                                                                                                                                                        conj                                 is ed,okvinthegoal                                                                                                             g                                                    tion of  a    goal on  a    statestillyieldsa streamof results,wno
                                                                                                                                                                                                                                                                                                                                                                                                                                                                       1                                           potentiallyinnite.Inthecasethattheocationvinofagoal
                                                                                     is  edokvinon the  currentstate;theresultof thisocationvin                                                                                                                                                                                                                                                                                                                                                                    g           returnsanon-emptystream,itmustbeeitheranimmature
                                                                                     is     a     nite stream(representedasa   proper nite list).The                                                                                                                                                                                                                                                                                                                                                             stream,orapairconsistingofsomestateandastream(either
                                                                                     resultingstreamisbydenitionnite,asthosewhichwnspa                                                                                                                                                                                                                                                                                                                                                                           matureor immature).Whenthecdrof                                                                                                                                                                                                                      $                   (in the third                                                                  cond
                                                                                     an     innitenumberof    resultsailf to     return.                                                                                                                                                                                                                                           bind                                  esvrecei                                                                                                                                                                                                                                                                                                                                               1
                                                                                     this resultingstreamandthegoal                                                                                                                                                                                            g              .    In                    bind                                  that goal (                                                      g       )                                          clauseof                                                        mplus                                     )    is    an    immaturestream,theevrecursiin-
                                                                                                                                                                                                                                                                                                                       2                                                                                                                                                                                           ocationvof                                                                  mplus                                        will matchthesecond                                                                                                                            cond                                 clause.This
                                                                                     is   edokvinon  each elementof  the   stream.If the   streamof                                                                                                                                                                                                                                                                                                                                                                then   returnsa                                                                                 λ which,                     when ed,okvinwillcontinuethe
                                                                                     resultsof                                                           g        1 is empty                  or     becomesxhaustede                                                                                                                                                                                  mzero                                    ,      the                                                                                                                                                                   $
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   searchformoreresultsinthat stream.The                                                                                                                                                                                                                                            λ is required                to
                                                                                     empty stream,is  returned.Ifinsteadthe streamcontainsa                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  $
                                                                                     stateandpotentiallymore,then                                                                                                                                                                          g          isedokvinontherststate.                                                                                                                                                                                     ensureterminationateachocation.vin
                                                                                     The streamwhichistheresultofthatocationvinisgedmerto                                                                                                                                                                                                                                                                                                                                                                                             The                           bind                                   operatoris  modied,similarlytocorrespond
                                                                                     a   streamcontainingtheocationvinoftherestofthe                                                                                                                                                                                                                                                                                    $           passed                                                                         with the   changeto                                                                                                         mplus                                     .    Sincestreamsmayalso wno  be
                                                                                     in  the secondgoal                                                                                                   g       .   The resultsoftheseocationsvininbind                                                                                                                                                                                                                                                          procedures,the                                                                                           procedure?                                                                               line  is     added to    accountfor
                                                                                     formthe resultofthe                                                                                                                    conj                             .   The                             bind                                 operatorisessentially                                                                                                                                                        that.eLikin                                                                    mplus                                    ,   the                       λ$ is wrapped around           theright-hand
                                                                                     an   implemementationof                                                                                                                                         append-map                                                                             [    10              ],  thoughwithits                                                                                                                                 sideto  ensuretermination.
                                                                                     gumentsarersed.vre                                                                                                                                                                                                                                                                                                                                                                                                                          (dene  (bind  $     g)
                                                                                                        The searchgystratetheseoperatorsimplementisadepth-                                                                                                                                                                                                                                                                                                                                                                                   (     cond
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ((null?$)     mzero)
                                                                                     rst    searchgystratelimitedto    a       nite  search space. The                                                                                                                                                                                                                                                                                                                                                                                                 .                                                                                                                                                                                                                        .
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ((ropcedure?$)(                                                                                       λ$() (bind                 ($)    g)))
                                                                                     implementationhereissimilarinyman respectsto that  of                                                                                                                                                                                                                                                                                                                                                                                                               (else  (mplus(g  (rca    $))    (bind  (cdr    $)     g)))))
                                                                                     SokuzaKanren[                                                                                            6       ]. Limitingqueriestoanitesearchspace,                                                                                                                                                                                                                                                                                          Makinguse of   this capacityrequiresentionintervonthe
                                                                                    ,ervwehoisan   unfortunateanderevserestriction.Consider                                                                                                                                                                                                                                                                                                                                                                        partof  the,useras in the wingfolloxample.eConsiderainag
                                                                                     the   denitionofthe goal constructor                                                                                                                                                                                                           fives                                         wbeloand   the                                                                                                                  the   denitionof                                                                                            fives                                         from  Section                                                                           4.1                 .    Thoughwe   wno
                                                                                     querythatwsfolloit.                                                                                                                                                                                                                                                                                                                                                                                                           evhathe  abilitytoreturnstreamsofinnitelyymanresults,
                                                                                                   >   (dene(ves x)   (disj  (                                                                                                                      ≡ x 5) (ves                        x)))                                                                                                                                                                                                                     with this denitionthequerywillstillailf to   terminatebe-
                                                                                                   >   ((call/freshves)y-stateempt)                                                                                                                                                                                                                                                                                                                                                                               causeof   sScheme'aluecall-by-vsemantics.If                                                                                                                                                                                                                                                              fives                                          is   in-
                                                                                                        This querywillailfto  terminate,asthecallto                                                                                                                                                                                                                                                             disj                                 will                                                          steaddenedas,wbelothequerywillinsteadreturn.
                                                                                    eokvin                                         mplus                                        to  collectallresultsandreturnsthemasalist.                                                                                                                                                                                                                                                                                                      (dene  (ves  x)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 .                                                                                                .                                                      .                                   .
                                                                                     orF  an   inniterelation,suchas                                                                                                                                                                           fives                                        e,vabocollectingall                                                                                                                                                                             (disj (                             ≡ x 5)                                          (     λg (s/c) (                                               λ$() (                            (ves   x)                                             s/c)))                              ))
                                                                                     the   resultsbeforereturningyanofthem ensuresno results                                                                                                                                                                                                                                                                                                                                                                       The act of  performinganerse-vin                                                                                                                                                                                  η on a goal            and thenwrap-
                                                                                     are returned.Aslightlymoresophisticatedapproachtocom-                                                                                                                                                                                                                                                                                                                                                                         ping its body in   a                                                                                                λ we refer to                      as erse-vin                                                                                                                    η.-delay   ers-vIn
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $
                                                                                     biningstreamsyieldsanabilitytoreturnstreamsofinnitely                                                                                                                                                                                                                                                                                                                                                                        η-delay      is   an  operationthatestakagoaland  returnsa goal,
                                                                                     ymanresults.                                                                                                                                                                                                                                                                                                                                                                                                                  as   the  resultof doingso   on  yan  goal                                                                                                                                                                                                    g is a function            froma
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   stateto a   stream.
                                                                                     4.2             InniteeamsStr                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               (     λ (s/c)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                g
                                                                                    oT    remedy this  limitation,                                                                                                                                                   mplus                                          and                          bind                                   must  be     aug-                                                                                                                                                                                                                        g                             ⇒η−1−delay                                                                                     (     λ$ ()
                                                                                     mentedwithanabilitytoreturnastreamwithoutcomputing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (     g s/c)))
                                                                                     the   answersit   contains.Thesewe term                                                                                                                                                                                                                            eimmatureamsstr                                                                                                   .                                                           In     order  to    ensure termination,whendesigningpoten-
                                                                                     When  returninga nite numberof   innitelyymanresults,                                                                                                                                                                                                                                                                                                                                                                       tiallynon-terminatinggoal-constructors,suchas(mutually)
                                                                                     the  resultis  a   partiallycomputedstream,withanimmature                                                                                                                                                                                                                                                                                                                                                                     ely-denedvrecursigoalconstructors,seriouscallsinthe
                                                                                     streaminthe cdr of  the last.pair                                                                                                                                                                                                                                                                                                                                                                                             bodyof suchgoal-constructorsmustbeerse-vin                                                                                                                                                                                                                                                                 η-delayed  in
                                                                                                        A    µKanrenstreamisthendenedtobe   eithertheempty                                                                                                                                                                                                                                                                                                                                                        order for  the  µKanrensearchto properlyterminate.Induc-
                                                                                     stream,animmaturestream,ora                                                                                                                                                                                          ematureamstr                                                                               ,   a    pairof  a                                                                                            ing  a    delaymay  also be   of  use  in   relationswhicharenite
.
                                                                                                      utb   multitudinous.eUnlikinminiKanren,properlyerse-vin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ithWthe  changehighlightedhere,weevachieacomplete
                                                                                                      η-delaying     seriousgoalsisthe  responsibilityofthe.user                                                                                                                                                                                                                                                                                                                                                                                                                                                       search.gystrateWherebefore we      ouldw evha    returnedan
                                                                                                                             As   a     consequenceofthischange,ecutionsxeofµKanren                                                                                                                                                                                                                                                                                                                                                                                                                                    immaturestreamwhich,whened,okvinouldwcontinuethe
                                                                                                      programscan   wno    also   returnan     immaturestreamas     part                                                                                                                                                                                                                                                                                                                                                                                                                                               search  as      it      asw     to      be     ed,okvinwe     wno     instead fhand-of
                                                                                                      of   a   result.Theusermay manuallyanceadvthecomputation                                                                                                                                                                                                                                                                                                                                                                                                                                                         controlto  the   aitingwstream,whilealsotakinga     step  with
                                                                                                      by    okingvinthe  immaturestream,or  more ,elylikeokvina                                                                                                                                                                                                                                                                                                                                                                                                                                                        the      one     which    had     viouslyprebeen    in       control. As      eryve
                                                                                                     elv-leuseroperatortoanceadva   streamuntil  it    matures,as                                                                                                                                                                                                                                                                                                                                                                                                                                                      nitestreamwillentuallyvebexhausted,eandtheuserwill
                                                                                                      describedinSection                                                                                                                                            5        .                                                                                                                                                                                                                                                                                                                                        erse-vin                                                    η-delay         ocationsvinofevrecursigoals,this change
                                                                                                                             Since the   basicgoals and  eryve goal  constructedbyone                                                                                                                                                                                                                                                                                                                                                                                                                                  meansthatnobranchcancontinuetomonopolizethesearch,
                                                                                                      of     the    basic  goal  constructorsareguaranteedtoterminate,                                                                                                                                                                                                                                                                                                                                                                                                                                                 andthusthisersionvof                                                                                                                                                          mplus                                                implementsacompletesearch
                                                                                                      and     since  we      requirethat   eryve  serious call   be     erse-vin                                                                                                                                                                                                                                                                                                                                                                         η-                                                          . gystrate
                                                                                                      delayed,thisseemstobea   whollyactorysatisfaywtosearch                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 The  completeµKanrensearchgystrateamountstosome-
                                                                                                      for  results.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    thing on    the   order of   a     tree  of    trampolines.Resultsgeemer
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       orderedroughlyby     the    number of     trampolinebouncesre-
                                                                                                      4.3                vingInterleaeamsStr                                                                                                                                                                                                                                                                                                                                                                                                                                                                           quiredto    nd   them  in    a    searchtree, and   approximates-per
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       formingthe searchin    parallel.Anotheranalogyisthatof    a
                                                                                                      ThoughµKanrenwill returnwith a     stream,the streammay                                                                                                                                                                                                                                                                                                                                                                                                                                                          jugglerjugglingjugglers,whereeachjuggleris   an                                                                                                                                                                                                                                                                                                                                                              mplus                                            ,
                                                                                                      be      such   that   it      will   containresults which  in     principlecan                                                                                                                                                                                                                                                                                                                                                                                                                                   and  the act  of   jugglingisrepresentedbythefhandofofcon-
                                                                                                      ervnebe returned.Depth-rstsearchervoinniterelationsis                                                                                                                                                                                                                                                                                                                                                                                                                                                          trol in   the   second                                                                                                                   cond                                         line of                                                mplus                                            .    It    is   the  searchstrat-
                                                                                                      an    incompletesearch.gystrateConsidertherelation                                                                                                                                                                                                                                                                                                                                                                sixes                                                                                          gye of   almostallminiKanrenimplementations,anduntilre-
                                                                                                      and  the  associatedquery.wbelo                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  cently[                                                  11                 ]    it   asw  at  leastthe  aultdefchoiceofall  published
                                                                                                                      >     (dene(sixes      x)                                                                                                                                                                                                                                                                                                                                                                                                                                                                       miniKanrenimplementations.
                                                                                                                                                   (disj        (                                   ≡ x 6) (                                                        λ (s/c)                 (                                        λ () ((sixes                      x)      s/c)))))
                                                                                                                                                                                                                                                                              g                                                               $
                                                                                                                      >     (denevesand-sixes-
                                                                                                                                                   (call/fresh(                                                                          λ (x)                   (disj  (ves   x)      (sixesx)))))                                                                                                                                                                                                                                                                                                                   5.                   elv-leUserFunctionality
                                                                                                                      >   and-sixes-(vesy-stateempt)
                                                                                                                             In     this  call,  all    answersreturnedwill be    states with   the                                                                                                                                                                                                                                                                                                                                                                                                                    Although,as  demonstratede,vaboone                                                                                                                                                                                                                                                                            can                               programin     the
                                                                                                      rst ariablevboundto5. This is   despitetheactfthatanother                                                                                                                                                                                                                                                                                                                                                                                                                                                       core   µKanren language,a     user   may     rightlydesire  a      more
                                                                                                      branch  also    containingsatisfyingresultsis  aitingwin      the                                                                                                                                                                                                                                                                                                                                                                                                                                                sophisticatedsetoftoolswithwhichtoprogramandthrough
                                                                                                      wings. In    order  to   evachiea     wider  spreadof     answers,it   is                                                                                                                                                                                                                                                                                                                                                                                                                                        which   to      wvie    the     results. A       sample  set     of       such    tools   is
                                                                                                      importantthata maturestreambeableto   yieldcontrol.                                                                                                                                                                                                                                                                                                                                                                                                                                                              vided.proThesecan certainlybe  furtheraugmentedtosuit
                                                                                                                             One     method to      accomplishthe fhand-ofof     control be-                                                                                                                                                                                                                                                                                                                                                                                                                           a    particularsuser'needs.Indeed,weevbelieitisa  virtueof
                                                                                                      tween   otw     or      more    proceduresis    a                                                                                                                                                                                                                                             binary  ampolinetr                                                                                                                         .       A                                                               the    µKanrenapproachthat  the    user   can    readilyand    easily
                                                                                                      trampoline[                                                                                  5         ]    videsprotheabilityto sharecontrolbetween                                                                                                                                                                                                                                                                                                                                                             augmentthissystemtoaingremuchofthe  functionalityofa
                                                                                                      procedures.In     a        binary  trampoline,otw   procedureseach                                                                                                                                                                                                                                                                                                                                                                                                                                               standardminiKanrenimplementation.
                                                                                                      etaka   stepaboundedamountofcomputationandthen                                                                                                                                                                                                                                                                                                                                                                                                                                                               5.1               eringvRecosen'miniKanrolcontroperators
                                                                                                      yieldcontroltothe.otherInthecaseofthebinarytrampoline
                                                                                                      this  ffstephandofstephandofsequencecontinuesuntil                                                                                                                                                                                                                                                                                                                                                                                                                                                        o T  ginbewith,manuallyperformingtheerse-vin                                                                                                                                                                                                                                                                                                                                 η-delay        can
                                                                                                      one  of   the otw producesaalue.vImplementingatrampoline                                                                                                                                                                                                                                                                                                                                                                                                                                                         quicklybecome tedious.The    user   can    instead yemplo the
                                                                                                      through                                                         mplus                                                  will causeeryvepath in   the   searchto  termi-                                                                                                                                                                                                                                                                                                                                          wbelomacro                                                                                             Zzz                               (pronouncedsnooze)toevreliesomeof
                                                                                                      nate aftera   boundedamountoforkawsinglebounceon                                                                                                                                                                                                                                                                                                                                                                                                                                                              the tedium.
                                                                                                      the    trampolineandthenyieldcontroltothe   xtne   aitingw                                                                                                                                                                                                                                                                                                                                                                                                                                                                      (dene-syntaxZzz
                                                                                                      possibledirectionofthecomputation.Theadditionofa  bi-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (syntax-rules   ()
                                                                                                      nary   trampolineis  accomplishedbya      small change to     the                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ((            _             g)      (                    λg(s/c)                 (                                        λ$() (g s/c))))))
                                                                                                      denitionof                                                                                       mplus                                            .                                                                                                                                                                                                                                                                                                                                                                                  oo,Tmanuallynestingcallsto                                                                                                                                                                                                         conj                                       and                            disj                                       can quickly
                                                                                                                             Considerainagthedenitionof                                                                                                                                                                                                                           mplus                                                 e.vaboWhen the                                                                                                                                                               wgro    tiresome.The   macros                                                                                                                                                                                                  conj+                                                    and                                disj+                                                    introduced
                                                                                                      search starts upon   a      path, it     has    no     ayw   to     viatedeuntil it                                                                                                                                                                                                                                                                                                                                                                                                                             wbelovideprothe                                                                                                                              conj                                        and                             disj                                        of  one  or   moregoals.
                                                                                                      xhaustsea    stream.If     instead,the  search along a      particular
                                                                                                      path is  mandatedtofhand-ofcontrolafteraboundedamount                                                                                                                                                                                                                                                                                                                                                                                                                                                                            (dene-syntaxconj+
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     (syntax-rules   ()
                                                                                                      of  ork,wthennoone branchwillmonopolizecontrol,andthe                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ((            _             g)      (Zzz  g))
                                                                                                      searchwillthen be  complete.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ((            _             g0    g                             . . . )                       (conj    (Zzz   g0)   (conj+g                                                                                                                                                       . . . )))))
                                                                                                                      (dene     (mplus$                                                                                                  1 $ 2)
                                                                                                                                     (      cond                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       (dene-syntaxdisj+
                                                                                                                                                   ((null?  $                                                   1)              $             2)                                                                                                                                                                                                                                                                                                                                                                                                     (syntax-rules   ()
                                                                                                                                                                                                                                                                                                                                                                            .                                                   .
                                                                                                                                                   ((ropcedure?$                                                                                         1)              (            λ () (mplus                                                                           $       2 ($                         1) )))                                                                                                                                                                                                                                             ((            _             g)      (Zzz  g))
                                                                                                                                                                                                                                                                                               $
                                                                                                                                                   (else   (cons   (rca     $                                                                                                    1)              (mplus(cdr    $                                                                                     1)              $              2)))))                                                                                                                                                                                                                          ((            _             g0    g                             . . . )                       (disj     (Zzz  g0)    (disj+   g                                                                                                                                             . . . )))))
                                                          Althoughnotstrictly,necessarywechooseto                                                                                                                                                       Zzz                eachofthe                                                              forniterelations,thecallto                                                                                                        pull                      is  unnecessaryutbbe-
                                                          goals.Auserwritingonlyintermsof                                                                                                                                 conj+                         and               disj+                         will                                      nign,andin  the laterersionsvitensuresthattheorkwof
                                                          notneedto  manually                                                                            Zzz                  thegoals.ithWthedenitionof                                                                                                                                         take                     and               take-all                                       ayswaloccurservoamaturestream.
                                                          Zzz                videdprothisentailsadelayarounderyvegoal,whereas
                                                          strictlyspeakingitisonlyrequiredaroundtheocationvinof                                                                                                                                                                                                                                   5.3       eringvRecoReication
                                                          seriousgoals.Amoresophisticatedimplementationof                                                                                                                                                                                               Zzz                                       Relationalprogramminglanguagestypicallyalsointroduce
                                                          thatgoesfordelayinggoalsconstructedfrom                                                                                                                                                           ≡ and simply                                                                          a meansbywhichtheusercan                                                                                                         eifyr                 theresults.                                     Reication                                      is
                                                          recursonsubgoalsofgoalsconstructedfrom                                                                                                                                                                   disj                  ,     conj                   ,                           theprocessbywhichtheusersloughsfofinformationfrom
                                                          and               call/fresh                                                ouldwcomeclosertotheideal.                                                                                                                                                                                  the resultingstreaminordertoclarifythepresentationof
                                                                      ithW                     conj+                       ,      disj+                      ,   and the basicgoalconstructorsof                                                                                                                                                  thatwhichisdesired.Reication,wnointhesuser'domain,
                                                          µKanren,the                                               conde                          and               fresh                          formsamiliarftominiKan-                                                                                                                       is asa  consequencemorexibleethaninymanminiKanren
                                                          renprogrammerscanbeintroducedasardstraightforwmacros                                                                                                                                                                                                                                    languages.Byplacingthereierunderthesuser'control,
                                                          as well.                                                                                                                                                                                                                                                                                ythearewno no  longermandatedtoreifyainstagtherst
                                                                   (dene-syntaxconde                                                                                                                                                                                                                                                            ariablevinthesystem,orlimitedtoreifyingtheresultonce.
                                                                           (syntax-rules()                                                                                                                                                                                                                                                       wNothatthesubstitutioncanbeboundandmanipulated,the
                                                                                   ((      _       (g0 g                    . . . )             . . . )          (disj+(conj+g0g                                                                  . . . )            . . . ))))                                                                   usercanreifyalongyannumberofdimensionsforferentdif
                                                                   (dene-syntaxfresh                                                                                                                                                                                                                                                            wsvieofthedata.yThewnoalsoevhatheabilitytochoose
                                                                           (syntax-rules()                                                                                                                                                                                                                                                       whothesubstitutionshouldbepresented,includingachoice
                                                                                   ((      _       ()    g0 g                       . . . )          (conj+g0g                                           . . . ))                                                                                                                                 betweenidempotent[                                                                           7    ]  or  triangularwsvieofthesubstitu-
                                                                                   ((      _       (x0 x                    . . . )         g0  g                   . . . )                                                                                                                                                                       tion.TheSchemeoperators                                                                                                 null?                         and                length                              canbothbe
                                                                                       (call/fresh(                                     λ (x0)       (fresh(x                                             . . . )          g0 g                    . . . ))))))                                                                                   seenasvialtrireiers,fortheuserseekingtowknosimply
                                                          conde                           is  simplythe                                               disj+                           of  a   (non-empty)sequenceof                                                                                                                               if yan resultswerefoundorwho.ymanThesamplereier
                                                          conj+                       s.  The                        fresh                           of  miniKanren,whichintroducesyan                                                                                                                                                            presentedhere,                                                       mK-reify                                     ,   is  typicalofotherminiKanren
                                                          numberoffreshariablesvintoscope,isuiltbasaevrecursi                                                                                                                                                                                                                                     languages.
                                                          macrousing                                             call/fresh                                                and               conj+                       .                                                                                                                                 (dene(mK-reifys/c                                                                  *  )
                                                                       The  ,user vinghaaugmentedtheirsystemwiththese                                                                                                                                                                                                                                              (mapreify-state/1strva-s/c                                                                                  *   ))
                                                         elv-lehigherfeatures,canfeelfreetoprogramwiththem,                                                                                                                                                                                                                                                (dene(reify-state/1strva-s/c)
                                                          andescapetoµKanrenformorene-grainedcontrolwhen                                                                                                                                                                                                                                                          (   let           ((v  (alkw                           *      (rva 0)  (rca  s/c))))
                                                          desired.                                                                                                                                                                                                                                                                                                         (alkw                *      v   (reify-sv                                    '   ()))))
                                                          5.2       omFreamsStrtoLists                                                                                                                                                                                                                                                                        The reierhere,                                                           mK-reify                                     ,   reiesalistof states                                                                             s/c*
                                                                                                                                                                                                                                                                                                                                                  by reifyingeachsstate'substitutionwithrespecttotherst
                                                         okingvInanimmaturestreamtoreturnresultstneedn'be                                                                                                                                                                                                                                        ariable.vThe                                              reify-s                                ,    reify-name                                             , and                 walk*                         helpersare
                                                          performed.manuallyithWanoperatorelik                                                                                                                                                    pull                    ,wbelothis                                                              requiredfor                                        varreify-state/1st-                                                                                       .
                                                          couldinsteadbedone.automatically                                                                                                                                                                                                                                                                 (dene(reify-sv s)
                                                                   (dene(pull$)  (if  (ropcedure?$)(pull($))$))                                                                                                                                                                                                                                                   (   let           ((v  (alkwv s)))
                                                                                                                                                                                                                                                                                                                                                                           (   cond
                                                          Thiswillsimplyanceadvthestreamuntilitmatures.                                                                                                                                                                                           pull                                                                             ((r?vav)
                                                          also returns                                             ()              for   the  emptystream(i.e.                                                                                                mzero                       ).   This                                                                                    (   let           ((n (reify-name(lengths))))
                                                          model,inwhichtheusergetsoneresultatatimefromthe                                                                                                                                                                                                                                                                                      (cons                    `   (,v   .    , n)  s)))
                                                                                                                                                                                                                                                                                                                                                                                   ((pair?v)   (reify-s(cdrv)(reify-s(rcav)s)))
                                                          system,isreminiscentofProlog.                                                                                                                                                                                                                                                                                            (elses))))
                                                                       pull                      itselfcanbe abstractedtooperationsthatpullall
                                                          resultsorpulltherst                                                                            nresults.                                                                                                                                                                                        (dene(reify-namen)
                                                                   (dene(etak-all(let$)      (($  (pull$)))                                                                                                                                                                                                                                                       (string (string-append"  symbol                                          _   "  "."(number                                         string   n))))
                                                                                   (if  (null?$)                                         '   ()   (cons(rca $)  (etak-all(cdr$))))))                                                                                                                                                                       (dene(alkw                                         *      v   s)
                                                                                                                                                                                                                                                                                                                                                                   (   let           ((v  (alkwv s)))
                                                                   (dene(etakn  $)                                                                                                                                                                                                                                                                                        (   cond
                                                                           (if  (zero?n)                                         '   ()                                                                                                                                                                                                                                            ((r?vav)  v)
                                                                                   (   let            (($   (pull  $)))                                                                                                                                                                                                                                                            ((pair?v)   (cons(alkw                                                                    *      (rca  v)  s)
                                                                                           (   cond                                                                                                                                                                                                                                                                                                                                                     (alkw                *      (cdr v)   s)))
                                                                                                   ((null?$)                                   '   ())                                                                                                                                                                                                                             (elsev))))
                                                                                                   (else(cons(rca $)  (etak(-    n  1)  (cdr $))))))))
                                                                       take-all                                         pullsall resultsfromthestream,and                                                                                                                                         take                                            5.4       eringvRecotheInterfacetoScheme
                                                          pullstherst                                                 n or as yman         resultsasthestreamcontains,                                                                                                                                                                           Theentionsvconforcallingprogramsandwingviethere-
                                                          ervwhicheisleast.Theuserisofcoursefreetoelopvdeother                                                                                                                                                                                                                                    sultscanbesimilarlyrened.eWintroduced                                                                                                                                                           empty-state
                                                          abstractionsoftheirwn.oIntheimplementationcorrectonly                                                                                                                                                                                                                                   in  Section                                     2        as  an  aliasfora   stateoidvdeofinformation.
.
                                                                                                      The   denitionis restated.wbeloeWintroducehereas  well                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (dene    (occurs                                                                                         x v s)
                                                                                                      call/empty-state                                                                                                                                              ,     an   operatorthatestaka  goal  as   an   -ar                                                                                                                                                                                                                                                                                                                               (      let                        ((v      (alkw  v      s)))
                                                                                                      gument  and    attemptsthat   goal   in      the                                                                                                                                                                                                                                                          empty-state                                                                                                 .       This                                                                                                                            (      cond
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ((r?va    v)      (r=?vav    x))
                                                                                                      reducesslightlysomeoftheboilerplateinokingvinµKanren                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        (else        (and  (pair?     v)      (                                                                                                                       ro                    (occurs                                           x (rca                        v)      s)
                                                                                                      program.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        (occurs                                           x (cdr                       v)      s)))))))
                                                                                                                      (dene      y-stateempt                                                                                                                         '      (()       .         0))
                                                                                                                      (dene     (ycall/empt-stateg)  (g     y-stateempt))                                                                                                                                                                                                                                                                                                                                                                                                                                                             (dene    (ext-s      x      v      s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     .                                                                                                                                                            .                                                                                                                          .       .
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     (if      (occurs                                                                         x      v      s)       #f                                                 `       ((,x   .         ,  v)      .         , s)                                                                    )       )
                                                                                                                             By    makinguse   of    the  e,vabothe   missing                                                                                                                                                                                                                                                                                run                                 and                              run*
                                                                                                      acesinterfof      miniKanrenare      also    erablevreco                                                                                                                                                                                                                                                                                                                     3      .             run                                    and                                                                                           In   the  viouspredenitionof                                                                                                                                                                                           mplus                                                 in   Section                                                                     4.3                     ,   ap-sw
                                                                                                      run*                                       ecutexethevidedprogoals,andcall                                                                                                                                                                                                                                            take                                       or                  take-all                                                                                                                    ping streamsinthe evrecursicallofthe third                                                                                                                                                                                                                                                                                                          cond                                         clausein
                                                                                                      as   appropriate.Here,                                                                                                                                           mK-reify                                                                            is  encodedintothe                                                                                                                               run                                and                                                                     additionto the   secondouldwlead to    a    airerfutiondistribof
                                                                                                      run*                                           macros;this  could  be     replacedby    a     ferentdif,reier                                                                                                                                                                                                                                                                                                                                                                                                   answerservo innitesearches,andouldwviateobmuch of
                                                                                                      or   the  denitionsof                                                                                                                                   run                               and                             run*                                        couldinsteadbeparama-                                                                                                                                                                                                                     the use  for erse-vin                                                                                                                          η-delay        ervonitesearches.
                                                                                                      terizedervothe reierand  the  choiceleftup    to   the  ultimate                                                                                                                                                                                                                                                                                                                                                                                                                                                                (dene    (mplus$                                                                                                  1 $ 2)
                                                                                                     .user                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           (      cond
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ((null?    $                                                   1)              $             2)
                                                                                                                      (dene-syntaxrun                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ((ropcedure?$                                                                                        1)              (            λ () (mplus                   $                                                                 2 ($                         1))))
                                                                                                                                     (syntax-rules   ()                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         $                                                          .                                                                         .
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    (else   (cons  (rca      $                                                                                                   1)              (mplus                                                    $       2 (cdr                 $                                  1))))) )
                                                                                                                                                   ((             _             n     (x                            . . . )                       g0   g                                    . . . )
                                                                                                                                                          (mK-reify(etak   n     (ycall/empt-state                                                                                                                                                                                                                                                                                                                                                                                                                                           The                                conj                                          and                              disj                                         goal  constructorsmightalsobe de-
                                                                                                                                                                                                                                                                                                          (fresh  (x                                                          . . . )                      g0    g                                   . . . )))))))                                                                                                                                                     ned,ferentlydifor,alentlyvequiothercorelanguageprim-
                                                                                                                      (dene-syntaxrun                                                                                                                *                                                                                                                                                                                                                                                                                                                                                               esviti  for      the     conjunctionand   disjunctionof    goals    might
                                                                                                                                     (syntax-rules   ()                                                                                                                                                                                                                                                                                                                                                                                                                                                                be    chosen in    their  stead.                                                                                                                                                                  conj+                                                   and                               disj+                                                   (or                         conj*                                                   and
                                                                                                                                                   ((             _             (x                   . . . )                       g0    g                                   . . . )                                                                                                                                                                                                                                                                                                                                   disj*                                            ,    ariantsvthatrepresenttheconjunction(disjunction)
                                                                                                                                                          (mK-reify(etak-all  (ycall/empt-state                                                                                                                                                                                                                                                                                                                                                                                                                        of    0     or    more  goals)could replace                                                                                                                                                                                                                            conj                                          and                              disj                                          as    prim-
                                                                                                                                                                                                                                                                                                                 (fresh  (x                                                          . . . )                      g0    g                                    . . . )))))))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      es.vitiA      number of     ferentdifimplementationsofeachare
                                                                                                                            iaV      the       e,vabo   the       user     ainsgre   much      of       the       xpres-e                                                                                                                                                                                                                                                                                                                                                                                              possible;theirprecisedenitionsareleftasercisesxeforthe
                                                                                                      enessvsiof      other   miniKanrenlanguages.Theseare     utb     a                                                                                                                                                                                                                                                                                                                                                                                                                                               interested.reader
                                                                                                      wfe   possibleelv-leuseradditionstothelanguage.Theuser
                                                                                                      might, for    instance,wish for    a                                                                                                                                                                                                                take-all/p                                                                                         ,      that   pulls all                                                                                                                                   7.                    ConclusionsandeFuturorkW
                                                                                                      resultsthatmatcha  certainpredicate.                                                                                                                                                                                                                                                                                                                                                                                                                                                                             In      this   ,paper we      present µKanren,a       featherweightim-
                                                                                                      6.                     The   Road not enakT                                                                                                                                                                                                                                                                                                                                                                                                                                                                      plementationofa   pure  relational(logic)programminglan-
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       guage.  µKanren is      the    smallestin      the     miniKanrenamilyf
                                                                                                      yManenhancementstothefunctionalityofthecorelanguage                                                                                                                                                                                                                                                                                                                                                                                                                                                              of     languages.Its ernelk is      entirelyfunctional,containsno
                                                                                                      are   also  possible.In a    languagewitha     pointerequalitytest                                                                                                                                                                                                                                                                                                                                                                                                                                               macros, and    comprisesutb   14      denitionsand   39     lines   of
                                                                                                      (e.g.                                  eq?                           ),   such as   Schemeor  Lisp,it   couldbe   used  instead                                                                                                                                                                                                                                                                                                                                                                                  code. As    such, we    evbeliethe  implementationisbothsim-
                                                                                                      of                    var-eq?                                                                   to    test for   the  identityof ariables.vThisouldw                                                                                                                                                                                                                                                                                                                                                             pler   to     understandand more   directlyportablethan  that   of
                                                                                                      dramaticallydecreasethecostof                                                                                                                                                                                                                                     walk                                    ,     thoughguablyarat                                                                                                                                                                                 otherminiKanrenlanguages.
                                                                                                      the  cost of   a   fectside-efintheimplementation.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   As    it    is    intendedto  be    a     bare-bonesimplementation,in-
                                                                                                                           e W  mightinsteadimplementthesubstitutionusinga-per                                                                                                                                                                                                                                                                                                                                                                                                                                        vitablyecertainfeaturestdon'emakthecut.Absentare   the
                                                                                                      sistenthash-table[                                                                                                                          9         ]   insteadofa  edlinklist.Thisouldwpro-                                                                                                                                                                                                                                                                                                                   impureoperatorsoftheoriginalminiKanren,constraintsbe-
                                                                                                      vide                                   O(1) lookup of ariablesv                                     in    the   substitutionandelim-                                                                                                                                                                                                                                                                                                                                                                             yondthesubstitution,andcutting-edgeoperatorsofthemore
                                                                                                      inate  the   use    of                                                                                                         assp                                          (or                         assq                                    )     in                          walk                                   .      In    the    core.logic                                                                                                                                                        evxpansieimplementations.Itdoesnotcomeequippedwith
                                                                                                      implementationofminiKanren,Nolen[                                                                                                                                                                                                                                                                                 8         ]    esvachiesigni-                                                                                                                                                                 a     ,reierand   the    user   must   etak  responsibilityforScheme
                                                                                                      cant performanceainsgbyimplementingthesubstitutionas                                                                                                                                                                                                                                                                                                                                                                                                                                                             inniteloops,andfor  erse-vin                                                                                                                                                                                                        η-delaying     evrecursigoals.It
                                                                                                      a    persistenthashtable.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        is  erthelessvnecientsuftoperformrealrelationalprogram-
                                                                                                                             Our       implementationof                                                                                                                                                                      unify                                             ,        as        mentioned in        Sec-                                                                                                                                                                                             ming tasks,and  generalenoughforend-userstoabstractits
                                                                                                      tion                                 4        ,      wsallo circularitiesinthe    substitution.miniKanren                                                                                                                                                                                                                                                                                                                                                                                                        aceinterfanduildbmorewerfulposearchtools.
                                                                                                      languagestypicallyprohibitthis.Using                                                                                                                                                                                                                                                                              occurs                                                      in the                    re-                                                                                                                           µKanrenvidesprowhat  we     evbelieis     a      reasonablerst
                                                                                                      denitionof                                                                                        ext-s                                                  wbeloouldwemak sµKanren'viorbeha                                                                                                                                                                                                                                                                                                                       introductiontotheinternalsofaeKanren-liklanguage.Stu-
                                                                                                      in   thisardgrecorrespondwiths.miniKanren'                                                                                                                                                                                                                                                                                                                                                                                                                                                                       dents,elopers,vdeandaspiringimplementersealikmaynd
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       µKanrena orthwhilewobjectofstudybeforevingdiintothe
                                                                                                      3        The  denitionsofrun                                                                                                                          and   run                                                    are  not   preciselythoseof miniKanren,
                                                                                                                                                                                                                                                                                                             *                                                                                                                                                                                                                                                                                                         internalsofanotherimplementation.
                                                                                                      as     ythe  wallo  0     or     more  ariablesvin   the   list   of    query  ariables.vThese
                                                                                                      denitionscan be     furtherconstraintedtovideproxactlyesminiKanren'                                                                                                                                                                                                                                                                                                                                                                                                                                                                  oo,T  the   smallerand  whollyfunctionalcoremay in     and
                                                                                                     .viorbeha                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         of  itselfencouragefurtheradoptionofminiKanren.Astrong
                                                                             ygienichmacro  system is     absent from   yman   major  lan-                                                                                                                                                                                                                                                                                                                          [10]                      O.  ers.vShi  List.LibrarySchemeRequestforImplementa-
                                                                             guages.A  referenceimplementationthatdoesnotetakad-                                                                                                                                                                                                                                                                                                                                                              tion.SRFI-1,1999.      URL                                                                                                                         http://srfi.schemers.org/
                                                                             antagevof   thosefeaturesmay ease  the  urdenbof    porting                                                                                                                                                                                                                                                                                                                                                      srfi-1/srfi-1.html                                                                                                        .
                                                                             to     such  languages.In so     doing µKanrenmay   help  emak                                                                                                                                                                                                                                                                                                                         [11]                      C.    ordsSwand   D.    Friedman.     rKanren:Guidedsearchin
                                                                             eminiKanren-liklanguagestheaultdefchoiceforelopersvde                                                                                                                                                                                                                                                                                                                                                            miniKanren.                                                         hemeScandFunctionalamminggroPr                                                                                                                                                                     ,  2013.
                                                                             lookingtorolltheirwnorelationalprogramminglanguages.                                                                                                                                                                                                                                                                                                                                   [12]                    . P  .adlerW      wHo   to    replaceailurefby  a     list  of    successes
                                                                                              In   futureresearch,wehopetoaingmorexperienceex-e                                                                                                                                                                                                                                                                                                                                               a    methodfor xceptionehandling,backtracking,andpattern
                                                                             tendingsµKanren'featuresetwithoutcompromisingtheel-                                                                                                                                                                                                                                                                                                                                                              matchinginlazy functionallanguages.In                                                                                                                                                                                                 Functionalo-Pr
                                                                             ancegeof    its   model.eW   hope  to    implementothersearch                                                                                                                                                                                                                                                                                                                                                    amminggresgLanguaandComputerehitecturcAr                                                                                                                                                                                                                   ,  pages113
                                                                             giesstrateinasimilarlyardstraightforw,mannerandperhaps                                                                                                                                                                                                                                                                                                                                                           128.,Springer1985.
                                                                             elopvdeamechanismtochangeoutsearchgiesstrateduring
                                                                             the courseofa  search.
                                                                                             eW evbeliethatthelanguagepresentedherexpressesethe                                                                                                                                                                                                                                                                                                                    ppendix:AenµKanrImplementation
                                                                             notionofa  purerelationalprogramminglanguageinamore
                                                                             concisemannerthanevhaearlierminiKanrenimplementa-                                                                                                                                                                                                                                                                                                                                                                (dene  (rva   c)    (rvecto c))
                                                                             tions.The  µKanrenmodelsmall,andevaticonservinits                                                                                                                                                                                                                                                                                                                                                               (dene  (r?va  x)    (r?vectox))
                                                                             featuresetutbeasilyxtensiblemayealsosuggestanother                                                                                                                                                                                                                                                                                                                                                              (dene (r=?vax                                                                        1 x 2) (= ref- r(vecto x                                                                                    1 0) ref- (rvecto  x                                                                    2 0)))
                                                                             pathardforwfortheminiKanrenmilyafoflanguages.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (dene  (alkwu    s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         (     let                ((rp   (and r?(va u)   (assp  (                                                                                                              λ (v)            (r=?vau  v))  s))))
                                                                             ledgmentswAckno                                                                                                                                                                                                                                                                                                                                                                                                                        (if    rp    (alkw(cdr   rp)    s)     u)))
                                                                            eW  xtendeourthanksto illWByrd and illWNessfor  their                                                                                                                                                                                                                                                                                                                                                             (dene  (ext-s    x    v    s)                                                                                        `     ((,x     .   , v)    .   , s))
                                                                             inspiration.eWalsothankAdamoltzerFandAndreulen-K                                                                                                                                                                                                                                                                                                                                                                 (dene  (                                       ≡ u v)
                                                                             schmidtfortheircommentsandcriticismsofearlierdrafts.                                                                                                                                                                                                                                                                                                                                                                        (     λg(s/c)
                                                                            eW     are    especiallygratefultoChung-chiehShan,Jeremy                                                                                                                                                                                                                                                                                                                                                                                (     let                 ((s     (unify  u    v    (rca   s/c))))
                                                                             Siek,Cameronords,SwandSamobin-HochstadtTfortheir                                                                                                                                                                                                                                                                                                                                                                                                  (if    s     (unit                                            `     (,s     .       , (cdr  s/c)))  mzero))))
                                                                             assistanceclarifyingthepresentationofthepresentrk.ow                                                                                                                                                                                                                                                                                                                                                             (dene    (unit   s/c)  (cons s/c  mzero))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (dene    mzero                                                               '   ())
                                                                             encesRefer                                                                                                                                                                                                                                                                                                                                                                                                       (dene  (unify   u   v     s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         (     let                 ((u   (alkwu    s))     (v    (alkwv    s)))
                                                                                    [1]                .F  Baaderand.W.yderSn Unication.theory                                                                                                                                                                                                               Handbookof                                                                                                                                            (     cond
                                                                                                        automatedeasoningr                                                                                         ,  1:445532,2001.                                                                                                                                                                                                                                                                                          ((andr?(va  u)   (r?va  v)    (r=?vau v))   s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ((r?va u)    (ext-s   u    v    s))
                                                                                    [2]                 D.   L.   Black,D.   B.   Golub,D. . P   Julin,R. .F    Rashid,R..P                                                                                                                                                                                                                                                                                                                                                    ((r?va v)    (ext-s    v    u    s))
                                                                                                       es,vDra R.     .W      Dean,   A.      orin,F  J.       Barrera,H.     okuda,T                                                                                                                                                                                                                                                                                                                                          ((and(pair?   u)   (pair?  v))
                                                                                                        G.  Malan,et  al.      ernelMicrokoperatingsystemarchitecture                                                                                                                                                                                                                                                                                                                                                               (     let                 ((s     (unify   (rca   u)   (rca   v)    s)))
                                                                                                        andMach.                                                ournalJofinformationocessingpr                                                                                                                                               , 14(4):442453,                                                                                                                                                                                  (and s     (unify  (cdr   u)   (cdr   v)    s))))
                                                                                                        1992.                                                                                                                                                                                                                                                                                                                                                                                                                  (else (and (eqv?u   v)    s)))))
                                                                                    [3]               . W  E.   Byrd.                                                           Relationalamminggroprinen:miniKanrh-tec                                                                                                                                                                                                                                                                       (dene  (call/freshf)
                                                                                                        niques,applications,andimplementations                                                                                                                                                                                   .     PhD thesis,Indi-                                                                                                                                                  (     λg(s/c)
                                                                                                        ana,ersityvUni2009.                                                                                                                                                                                                                                                                                                                                                                                         (     let               ((c    (cdr   s/c)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ((f      (rva   c))                                                   `      (,(rca   s/c)  .       , (+   c   1))))))
                                                                                    [4]                 D..P Friedman,.WE.Byrd,andO..vKiselyo                                                                                                                                                                                                            The Reasoned
                                                                                                       hemerSc                                     .    TheMITPress,July2005.ISBN0262562146.                                                                                                                                                                                                                                                                                                  (dene (disj  g                                                             1 g 2) (                              λg(s/c)           (mplus(g                                                                   1 s/c)          (g                              2 s/c))))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              (dene  (conj  g                                                                 1 g 2) (                             λ (s/c)           (bind  (g                                                             1 s/c)          g                          2)))
                                                                                    [5]                 S.   E.    Ganz, D.  .P    Friedman,andM.  and.W       rampolinedT                                                                                                                                                                                                                                                                                                                                                                                                                                                 g
                                                                                                        style. In                                        oc.Pr4thCMA SIGPLANinternationalenceconfer                                                                                                                                                                                                                                                                                           (dene  (mplus$                                                                        1 $ 2)
                                                                                                        on Functionalamminggropr                                                                                                                        ,  pages1827.CMAPress,1999.                                                                                                                                                                                                                     (     cond
                                                                                    [6]                 O.     .vKiselyo             The     taste    of      logic    programming,2006.                                                                                                                                                                                                                                                                                                                            ((null?  $                                      1)          $          2)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ((ropcedure?$                                                                1)          (         λ () (mplus           $                                                 2 ($                  1))))
                                                                                                        URL                                                        http://okmij.org/ftp/Scheme/misc.html#                                                                                                                                                                                                                                                                                                                                                                                                                     $
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    (else (cons (rca   $                                                                           1)          (mplus(cdr$                                                                 1)          $          2)))))
                                                                                                        sokuza-kanren                                                                          .
                                                                                    [7]                 J..W yd.Llo                                                      oundationsFofgicLo,amminggroPr1stEdition                                                                                                                                                                                                             .                                                               (dene  (bind $     g)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         (     cond
                                                                                                       ,Springer1984.ISBN3-540-13299-6.                                                                                                                                                                                                                                                                                                                                                                             ((null?  $)    mzero)
                                                                                    [8]                 D.  Nolen.   core.logic,2013.URL                                                                                                                                                          https://github.com/                                                                                                                                                                                               ((ropcedure?$)(                                                                              λ$() (bind              ($)    g)))
                                                                                                        clojure/core.logic                                                                                                      .                                                                                                                                                                                                                                                                                   (else (mplus(g  (rca   $))    (bind (cdr   $)    g)))))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ..
                                                                                    [9]                 C.  Okasaki.                                                          elyPurfunctionaldataesstructur                                                                                                                                                .         Cambridge
                                                                                                       ersityvUniPress,1999.
